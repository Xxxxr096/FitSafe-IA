<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Programme Humain - FitSafe IA</title>

  <!-- Fonts & Tailwind -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='image/logo2.png') }}" />

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at top, #0a0a0a 0%, #111 40%, #1a1a1a 100%);
      color: white;
      overflow-x: hidden;
    }

    .progress-bar {
      position: fixed;
      top: 0;
      left: 0;
      height: 3px;
      width: 0%;
      background: linear-gradient(90deg, #ef4444, #ff6b6b);
      box-shadow: 0 0 10px #ef4444;
      animation: load-bar 4s infinite;
      z-index: 50;
    }

    @keyframes load-bar {
      0% { width: 0%; }
      50% { width: 80%; }
      100% { width: 100%; }
    }

    .card {
      background: rgba(30,30,30,0.9);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 1rem;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(239,68,68,0.3);
    }

    .nav-link-glow {
      font-weight: 700;
      background: linear-gradient(90deg, #ef4444, #ff006e, #00ffff, #ef4444);
      background-size: 300%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: glow-shift 3s linear infinite;
      text-shadow: 0 0 10px rgba(255,255,255,0.3);
      transition: transform 0.3s ease;
    }
    .nav-link-glow:hover {
      transform: scale(1.15);
      text-shadow: 0 0 20px rgba(255,255,255,0.6);
    }

    @keyframes glow-shift {
      0% { background-position: 0%; }
      100% { background-position: 300%; }
    }

    .neon-btn {
      --clr-neon: #ef4444;
      --clr-bg: transparent;
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      color: var(--clr-neon);
      display: inline-block;
      border: var(--clr-neon) 2px solid;
      padding: 0.4em 1em;
      border-radius: 0.5em;
      text-shadow: 0 0 0.5em #fff, 0 0 0.8em var(--clr-neon);
      box-shadow: inset 0 0 0.8em var(--clr-neon), 0 0 1em var(--clr-neon);
      background: var(--clr-bg);
      transition: all 0.25s ease;
    }
    .neon-btn:hover {
      color: white;
      text-shadow: 0 0 10px #fff, 0 0 20px var(--clr-neon);
      transform: scale(1.05);
    }

    .fade-up {
      opacity: 0;
      transform: translateY(40px);
      transition: all 1s ease;
    }
    .fade-up.visible {
      opacity: 1;
      transform: translateY(0);
    }

    footer:hover h1 {
      color: #ef4444;
      text-shadow: 0 0 20px #ef4444;
    }

    #neural-bg {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 0;
      overflow: hidden;
      pointer-events: none;
    }

    main, header, footer {
      position: relative;
      z-index: 2;
    }
  </style>
</head>

<body class="bg-neutral-950 text-white font-poppins">
  <!-- ===== NAVBAR ===== -->
  <header class="fixed top-0 w-full z-40 bg-neutral-900/80 backdrop-blur-md border-b border-neutral-800">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-6 py-4">
      <h1 class="text-2xl font-orbitron font-bold text-red-500 tracking-wide">
        FitSafe <span class="nav-link-glow">IA</span>
      </h1>

      <nav class="hidden md:flex space-x-8 text-sm font-medium">
        <a href="{{ url_for('home') }}" class="text-red-500 font-semibold">Accueil</a>
        <a href="{{ url_for('dashboard') }}" class="hover:text-red-500 transition">Tableau de bord</a>
        <a href="{{ url_for('advis') }}" class="hover:text-red-500 transition">Conseils</a>
        <a href="{{ url_for('profil') }}" class="hover:text-red-500 transition">Profil</a>
        <a href="{{ url_for('contact') }}" class="hover:text-red-500 transition">Contact</a>
        <a href="{{ url_for('ia') }}" class="nav-link-glow">IA</a>
        <a href="{{ url_for('humain') }}" class="nav-link-glow hover:text-red-400 transition">Humain</a>
        {% if current_user.is_admin %}
          <a href="{{ url_for('admin_dashboard') }}" class="nav-link-glow hover:text-red-400 transition">
            üõ† Admin
          </a>
        {% endif %}
      </nav>

      {% if current_user.is_authenticated %}
      <div class="flex items-center gap-4">
        <button id="notif-btn" class="relative text-neutral-400 hover:text-red-500 transition" title="Notifications">
          <i data-lucide="bell"></i>
          <span id="notif-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-4 h-4 flex items-center justify-center">3</span>
        </button>
        <a href="{{ url_for('logout') }}" class="text-sm text-neutral-400 hover:text-red-500 transition">Se d√©connecter</a>
      </div>
      {% else %}
      <a href="{{ url_for('login') }}" class="text-sm text-neutral-400 hover:text-red-500 transition">Se connecter</a>
      {% endif %}
    </div>
  </header>

  <!-- ===== CONTENU PRINCIPAL ===== -->
  <main class="pt-32 pb-24 px-6 max-w-5xl mx-auto text-center fade-up">
    <p class="text-red-400 mb-2 tracking-widest text-sm uppercase">
      <span class="nav-link-glow">Human touch detected...</span>
    </p>
    <h2 class="text-4xl md:text-6xl font-orbitron font-extrabold mb-4 glow">
        Programme <span class="nav-link-glow">Humain</span> pour t‚Äôentra√Æner <br /> plus intelligemment üß¨
    </h2>

    <p class="text-neutral-300 mb-10 max-w-2xl mx-auto leading-relaxed">
      Tu pr√©f√®res un accompagnement humain ? D√©cris ton objectif et notre
      √©quipe te pr√©parera un programme sur mesure.  
      Tu recevras un lien priv√© d√®s qu‚Äôil sera pr√™t.
    </p>

    <!-- FORMULAIRE -->
    <form method="POST" class="card p-8 text-left space-y-5 max-w-2xl mx-auto">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <label class="block text-neutral-300 text-sm mb-2 font-medium">Ton objectif :</label>
      <textarea name="objectif" rows="4"
        class="w-full bg-neutral-800 border border-neutral-700 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-red-600 focus:outline-none"
        placeholder="Ex : Je veux perdre du poids et tonifier mes jambes..." required></textarea>

      <div class="text-center mt-8">
        <button type="submit" class="neon-btn"><span class="nav-link-glow">Envoyer ma demande üöÄ</span></button>
      </div>
    </form>

    <!-- HISTORIQUE -->
    <section class="mt-20 fade-up">
      <h3 class="text-3xl font-orbitron font-semibold mb-6 glow">üìã Mes demandes pr√©c√©dentes</h3>

      {% if demandes %}
      <ul class="space-y-5 max-w-2xl mx-auto">
        {% for d in demandes %}
        <li class="card p-5 text-left">
          <p class="text-neutral-300 mb-1"><strong>Objectif :</strong> {{ d.objectif }}</p>

          <p class="text-sm text-neutral-400 mt-1">
            Statut :
            {% if d.status == "En attente" %}
              <span class="text-yellow-400">‚è≥ En attente</span>
            {% elif d.status == "Valid√©" %}
              <span class="text-green-400">‚úÖ Termin√©</span>
            {% else %}
              <span class="text-red-400">‚ùå Refus√©</span>
            {% endif %}
          </p>

          {% if d.response_link %}
          <div class="mt-3">
            <a href="{{ d.response_link }}" target="_blank" class="text-red-400 hover:text-red-500 underline">üìé Voir mon programme</a>
            <p class="text-xs text-neutral-500 mt-1">
              Envoy√© le {{ d.response_date.strftime('%d/%m/%Y') }}
            </p>
          </div>
          {% endif %}

          <!-- üöÄ Bouton Supprimer -->
          <form method="POST" action="{{ url_for('delete_request', request_id=d.id) }}" class="mt-4 text-right">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="neon-btn text-xs px-4 py-1"
              onclick="return confirm('Souhaites-tu vraiment supprimer cette demande ? üö®');">
              üóëÔ∏è Supprimer
            </button>
          </form>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-neutral-500 italic">Aucune demande pour le moment.</p>
      {% endif %}
    </section>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="bg-neutral-950 border-t border-neutral-800 py-10 text-center">
    <h1 class="text-2xl font-orbitron font-bold mb-2 text-white transition">
      FitSafe <span class="nav-link-glow">IA</span>
    </h1>
    <p class="text-neutral-500 text-sm mt-4">
      ¬© 2025 FitSafe AI ‚Äî
      <a href="{{ url_for('privacy') }}" class="text-red-400 hover:text-red-500 underline">
        Politique de confidentialit√©
      </a>
    </p>
  </footer>

  <script>
    lucide.createIcons();

    const fadeEls = document.querySelectorAll(".fade-up");
    const obs = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) entry.target.classList.add("visible");
      });
    }, { threshold: 0.2 });
    fadeEls.forEach((el) => obs.observe(el));
  </script>

  <!-- ===== FOND NEURONAL ===== -->
  <div id="neural-bg"></div>
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.162.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.162.0/examples/jsm/"
    }
  }
  </script>

  <script type="module">
  import * as THREE from 'three';
  import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
  import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
  import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
  import { ShaderPass } from 'three/addons/postprocessing/ShaderPass.js';
  import { GammaCorrectionShader } from 'three/addons/shaders/GammaCorrectionShader.js';

  let scene, camera, renderer, composer;
  let connections = [];
  const connectionDistance = 4, numNeurons = 120;

  init(); animate();

  function init() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.z = 8;

    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.domElement.style.position = 'fixed';
    renderer.domElement.style.top = 0;
    document.getElementById('neural-bg').appendChild(renderer.domElement);

    scene.add(new THREE.AmbientLight(0xffffff, 0.5));
    createNetwork();

    composer = new EffectComposer(renderer);
    composer.addPass(new RenderPass(scene, camera));
    composer.addPass(new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 0.9, 0.5, 0.9));
    composer.addPass(new ShaderPass(GammaCorrectionShader));

    window.addEventListener('resize', onResize);
  }

  function createNetwork() {
    const geo = new THREE.SphereGeometry(0.05, 8, 8);
    const neurons = [];

    for (let i = 0; i < numNeurons; i++) {
      const color = Math.random() > 0.5 ? 0x00ffff : 0xff0044;
      const mat = new THREE.MeshBasicMaterial({ color, transparent: true, opacity: 0.8 });
      const node = new THREE.Mesh(geo, mat);
      node.position.set((Math.random() - 0.5) * 20, (Math.random() - 0.5) * 10, (Math.random() - 0.5) * 15);
      scene.add(node);
      neurons.push(node);
    }

    const material = new THREE.LineBasicMaterial({ color: 0x00ffff, transparent: true, opacity: 0.15 });
    for (let i = 0; i < neurons.length; i++) {
      for (let j = i + 1; j < neurons.length; j++) {
        const a = neurons[i].position, b = neurons[j].position;
        if (a.distanceTo(b) < connectionDistance && Math.random() < 0.3) {
          const lineGeo = new THREE.BufferGeometry().setFromPoints([a, b]);
          const line = new THREE.Line(lineGeo, material.clone());
          line.userData = { baseOpacity: Math.random() * 0.3 + 0.1, speed: Math.random() * 2 + 0.5 };
          scene.add(line);
          connections.push(line);
        }
      }
    }
  }

  function animate() {
    requestAnimationFrame(animate);
    scene.rotation.y += 0.001;
    connections.forEach(l => {
      const t = Math.sin(Date.now() * 0.001 * l.userData.speed) * 0.5 + 0.5;
      l.material.opacity = l.userData.baseOpacity + t * 0.3;
    });
    composer.render();
  }

  function onResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
    composer.setSize(window.innerWidth, window.innerHeight);
  }
  </script>
</body>
</html>
